
Trend
 Micro 



About
 TrendLabs Security Intelligence Blog 



Search:Goto…HomeCategoriesHome...Malware... Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan 
Operation Overtrap Targets Japanese Online BankingUsers Via Bottle Exploit Kit and Brand-New CinobiBanking Trojan 

Posted on:March 11, 2020 
at 6:00 am 

Posted in:Malware 


Author: 
Trend Micro 


By Jaromir Horejsi and Joseph C. Chen (Threat Researchers) 
We recently discovered a new campaign that we dubbed “Operation Overtrap” for the numerous ways it can infect or trapvictims with its payload. The campaign mainly targets online users of various Japanese banks by stealing their bankingcredentials using a three-pronged attack. Based on our telemetry, Operation Overtrap has been active since April 2019 and hasbeen solely targeting online banking users located in Japan. Our analysis found that this campaign uses three different attackvectors to steal its victims’ banking credentials: 

By
 sending spam emails with a phishing link to a page disguised as a banking website


By
 sending spam emails asking victims to run a disguised malware’s executable downloaded from a linked phishing page.


By
 using a custom exploit kit to deliver malware via malvertising 


Figure 1. Operation Overtrap three-pronged attack .ow 
This blog will discuss how we discovered the campaign and introduce the brand-new banking trojan Cinobi. Meanwhile, adetailed look at the different attack vectors associated with this campaign, and a more in-depth analysis of droppedcon.guration .les as well as Cinobi’s features, are discussed in our technical brief. 


Technical Analysis 
Discovering Operation Overtrap 
We .rst discovered the campaign in September 2019 using a then-unidenti.ed exploit kit. Based on our data, OperationOvertrap has been using spam emails to deliver its payload to victims as early as April 2019. 
In mid-September, we observed a signi.cant number of victims being redirected to the exploit kit, which targeted InternetExplorer, after they have clicked on links from social media platforms. It should be noted, however, that the way the victimsreceived the links has not been identi.ed. It is also worth mentioning that Operation Overtrap only seems to target Japaneseonline banking users; it redirects victims with other geolocations to a fake online shop. 
Upon analysis, we saw that the exploit kit only dropped a clean binary that does not perform malicious activities on a victim’sdevice. It also immediately closes after infection. It is still unclear why the threat actors behind Operation Overtrap initiallydelivered a clean binary .le; it’s possible that they were testing their custom exploit kit during this stage of the campaign’sdevelopment. 
Figure 2. A screengrab that shows exploit kit network traf.c in September 2019 
Figure 3. A screengrab that shows a clean .le dropped by Operation Overtrap’s exploit kit 

Operation Overtrap’s Custom Exploit Kit: Bottle Exploit Kit 
On September 29, 2019, we observed that the exploit kit ceased to drop a clean .le, and instead, delivered a brand-newbanking trojan that we dubbed “Cinobi.” We also noted that the threat actors behind Operation Overtrap have stoppedredirecting victims from social media and began to use a Japan-targeted malvertising campaign to push their custom exploitkit. 
Another researcher later discovered the custom exploit kit, which was named the Bottle Exploit Kit (BottleEK). It exploitsCVE-2018-15982, a Flash Player use after free vulnerability, as well as CVE-2018-8174, a VBScript remote code executionvulnerability. Victims will be infected with BottleEK’s payload if they access this particular exploit kit’s landing page withunpatched or outdated browsers. Our telemetry shows that BottleEK was the most active exploit kit detected in Japan inFebruary 2020. 
Figure 4. Exploit kit activity observed in Japan on February 2020 (Data obtained from Trend Micro Smart ProtectionNetwork.) 

Brand-new banking malware: Cinobi 
Operation Overtrap used a new banking malware we’ve decided to call Cinobi. Based on our analysis, Cinobi has two versions
― the .rst one has a DLL library injection payload that compromises victims’ web browsers to perform form-grabbing. 
This Cinobi version can also modify web traf.c sent to and received from targeted websites. Our investigation found that allthe websites that this campaign targeted were those of Japan-based banks. 
Aside from form-grabbing, it also has a webinject function that allows cybercriminals to modify accessed webpages. Thesecond version has all the capabilities of the .rst one plus the ability to communicate with a command-and-control (C&C)server over the Tor proxy. 
3/12/2020 Operation Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi Banking Trojan - TrendLabs Security In… 

Cinobi’s four stages of infection 
Each of Cinobi’s four stages contains an encrypted position-independent shellcode that makes analysis slightly morecomplicated. Each stage is downloaded from a C&C server after certain conditions have been met. 
First stage 
The .rst stage of Cinobi’s infection chain, which has also been analyzed by another cybersecurity researcher, starts by calling the “GetUserDefaultUILanguages” function to check if the infected device’s local settings are set to Japanese. 
Figure 5. Screengrab of Cinobi’s check to determine the device’s language settings using “GetUserDefaultUILanguages” 
Cinobi will then download legitimate unzip.exe and Tor applications from the following locations: 

ftp://ftp[.]cadwork.ch/DVD_V20/cadwork.dir/COM/unzip[.]exe

https://archive[.]torproject[.]org/tor-package-archive/torbrowser/8.0.8/tor-win32-0.3.5.8[.]zip 
After extracting the Tor archive into the “\AppData\LocalLow\” directory, Cinobi will rename tor.exe to taskhost.exe andexecute it. It will also run tor.exe with custom torrc .le settings. 

“C:\Users\<username>\AppData\LocalLow\<random_name>\Tor\taskhost.exe” Cf“C:\Users\<username>\AppData\LocalLow\<random_name>\torrc” 

It will download the second stage of the malware payload from a .onion C&C address and save it in a randomly named .DLL.le within the “\AppData\LocalLow\” folder. The .lename of the .rst stage downloader is saved into a .JPG .le with a random name. 
Figure 6. Screengrab of the .JPG .le that contains the .lename of the .rst stage downloader After this, Cinobi will run the second stage of its downloader on the victim’s machine. 
Figure 7. Screengrab of code showing Cinobi running the second stage of its downloader on the victim’s machine 

Second stage 
Cinobi will connect to its C&C server to download and decrypt the .le for the third stage of its infection chain. We observedthat the .lename of the third stage starts with the letter C, followed by random characters. Afterward, it will download anddecrypt the .le for the fourth stage, which has a .lename that starts with the letter A, followed by random characters. 
After these, Cinobi will download and decrypt a con.g .le (<random_name>.txt) that contains a new C&C address. 
Cinobi uses RC4 encryption with a hardcoded key. 
Next, Cinobi will run the downloaded third stage infection .le using the UAC bypass method via the CMSTPLUA COM 
interface. 


Third stage 
During the third infection stage, Cinobi will copy malware .les from “\AppData\LocalLow\” to the “%PUBLIC%” folder. Itwill then install the fourth stage of the downloader (which was downloaded during the second stage) as Winsock Layered 
Service Provider (WSCInstallProviderAndChains). 

Figure 9. Screengrab of code showing the installation of the infection’s fourth stage on the victim machine as“WSCInstallProviderAndChains” 
Cinobi will then perform the following actions: 

Change
 spooler service con.g to “SERVICE_AUTO_START”


Disable
 the following services:UsoSvc Wuauserv WaaSMedicSvc SecurityHealthServiceDisableAntiSpyware


Copy
 and extract Tor .les to “%PUBLIC%” folder


Rename
 tor.exe to taskhost.exe 


Create
 torrc in “%PUBLIC%” with the content “DataDirectory C:\Users\Public\<random_nam>\data\tor”


Create
 .JPG .le with the original dropper name


Remove
 .les from “\AppData\LocalLow\,” remove original dropper .le 








Fourth stage 
Cinobi will call the WSCEnumProtocols function to retrieve information about available transport protocols. It will also callthe WSCGetProviderPath function to retrieve the DLL path of the original transport provider. This function is called twice.The .rst call will return the malicious provider (as the fourth stage of the malware has already been installed during the thirdstage of infection). The second call will return the original transport provider (“%SystemRoot%\system32\mswsock.dll”) andresolve and call its WSPStartup function. Cinobi will then check the name of the process in which the malicious DLL providergets injected. In practice, Cinobi should be injected into all processes that make network connections using Windows sockets. 
Figure 10. Screengrab of processes where the malicious DLL provider has been injected 



Best practices against spam and vulnerabilities 
Operation Overtrap uses a variety of attack vectors to steal banking credentials. Users and organizations need to adopt best 
practices to protect their systems against messaging-related threats and avoid malicious advertisements. An example of a bestpractice is to have a central point for reporting suspicious emails. Organizations, through their IT teams, need to have a 
https://blog.trendmicro.com/trendlabs-security-intelligence/operation-overtrap-targets-japanese-online-banking-users-via-bottle-exploit-kit-and-brand-new-cinob… 5/8 
centralized information gathering system, and all employees must be aware of the reporting procedure for suspicious emails.Meanwhile, users can avoid malicious advertisements by avoiding clicking on suspicious links or pop-ups and updatingsoftware via of.cial channels. 
Organizations will bene.t from regularly updating systems (or use.virtual patching.for legacy systems) to prevent attackersfrom taking advantage of security gaps. Additional security mechanisms like .rewalls.and.intrusion detection and preventionsystems.will help thwart suspicious network activities such as data ex.ltration or C&C communication. 

Trend Micro Solutions 
Organizations can consider Trend Micro. endpoint solutions such as.Trend Micro Smart Protection Suites.and.Worry-Free. 
Business Security. Both solutions can protect users and businesses from threats by detecting malicious .les and spammedmessages as well as blocking all related malicious URLs..Trend Micro Deep Discovery..has an email inspection layer thatcan protect enterprises by detecting malicious attachments and URLs. 
Trend Micro. Hosted Email Security.is a no-maintenance cloud solution that delivers continuously updated protection thatstops spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network. It protectsMicrosoft Exchange,.Microsoft Of.ce 365, Google Apps, and other hosted and on-premises email solutions. 
For defending against malvertising campaigns in general, users can employ Trend Micro. Maximum Security, which protectsconsumers via a multi-layered defense that delivers highly effective and ef.cient protection against ever-evolvingthreats..Trend Micro. Smart Protection Suites.also protect businesses against these types of threats by providing threatprotection techniques designed to eliminate security gaps across multiple users and endpoints. 
You may read our in-depth analysis of Operation Overtrap in this.technical brief, which also contains details about possiblelinks to other phishing campaigns and the indicators of compromise. 
Related Posts: 

Latest Trickbot Campaign Delivered via Highly Obfuscated JS FileNew Exploit Kit Capesand Reuses Old and New Public Exploits and Tools, Blockchain Ruse 



Learn how to protect Enterprises, Small Businesses, and Home Users from ransomware: 
ENTERPRISE 
. SMALL BUSINESS 
. HOME 
. 
Tags: banking malwarebanking TrojanBottle exploit kitBottleEKCinobiexploit kitOperation Overtrap 

0 Comments TrendLabs 
.. 
Privacy 
Policy 
]1 Login 

. Recommend t Tweet f Share Sort by Best 


Start the discussion… 
LOG IN WITH 
OR SIGN UP WITH DISQUS 


Be the .rst to comment. 
. 
Subscribe 
d 
Add 
Disqus 
to 
your 
siteAdd 
DisqusAdd 
D NtSll 
M 
Dt
. 
Security Predictions for 2020 

Cybersecurity in 2020 will be viewed through many lenses ― from differing attacker motivations and cybercriminalarsenal to technological developments and global threat intelligence ― only so defenders can keep up with the broadrange of threats.
Read our security predictions for 2020. 


Business Process Compromise 

Attackers are starting to invest in long-term operations that target speci.c processes enterprises rely on. They scout forvulnerable practices, susceptible systems and operational loopholes that they can leverage or abuse. To learn more, read 
our Security 101: Business Process Compromise. 


Recent Posts 

Operation
 Overtrap Targets Japanese Online Banking Users Via Bottle Exploit Kit and Brand-New Cinobi BankingTrojan


March
 Patch Tuesday: LNK, Microsoft Word Vulnerabilities Get Fixes


Busting
 Ghostcat: An Analysis of the Apache Tomcat Vulnerability (CVE-2020-1938 and CNVD-2020-10487)


Dissecting
 Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks


Security
 Risks in Online Coding Platforms 




Popular Posts 
LokiBot Impersonates Popular Game Launcher and Drops Compiled C# Code File 

Miscon.gured Container Abused to Deliver Cryptocurrency-mining Malware 

Dissecting Geost: Exposing the Anatomy of the Android Trojan Targeting Russian Banks 
February Patch Tuesday: Fixes for Critical LNK, RDP, Trident Vulnerabilities 

Angler and Nuclear Exploit Kits Integrate Pawn Storm Flash Exploit 


Stay Updated 
YouremailhereSubscribeEmail Subscription 
Home and Home Of.ce 

|

For Business 


|


Security Intelligence

|


About Trend Micro 


Asia Paci.c Region (APAC): Australia / New Zealand, 中国, .本, ...., 台 


Latin America Region (LAR): Brasil, México 


North America Region (NABU): United States, Canada 



Europe, Middle East, & Africa Region (EMEA): France, Deutschland / .sterreich / Schweiz, Italia, Россия, Espa.a,United Kingdom / Ireland 


Privacy Statement

Legal Policies 


Copyright . 2020 Trend Micro Incorporated. All rights reserved. 





